# Лабораторная №14 (`WW_exceptions`)

## Содержание
1. [Содержание](#содержание)
1. [Задание](#задание)
1. [Требования к корректности решения](#требования-к-корректности-решения)
    1. [Стандартные требования](#стандартные-требования)
    1. [Детали реализации](#детали-реализации)
    1. [Консольное приложение](#консольное-приложение)
    1. [Команда `load`](#команда-load)
    1. [Команда `print`](#команда-print)
    1. [Команда `add`](#команда-add)
    1. [Команда `mul`](#команда-mul)
    1. [Команда `elem`](#команда-elem)
    1. [Команда `exit`](#команда-exit)
    1. [Структура репозитория](#структура-репозитория)
1. [Сроки сдачи](#сроки-сдачи)
1. [Система оценки](#система-оценки)

## Задание
Требуется реализовать интерпретатор assembler-like языка,
работающего с матрицами произвольного размера, которые хранят
целочисленные элементы.

* Интерпретатор хранит матрицы произвольного размера в *десяти* регистрах,
  нумерация регистров начинается с *нуля*.
* По умолчанию в регистре хранится матрица размера `0 x 0`.
* Интерпретатор  последовательно выполняет команды, считанные из стандартного потока ввода.

Должны поддерживаться следующие команды (смотри подробное описание ниже):

| Команда | Семантика |
|---|---|
| `load <reg> <fname>` | Загружает матрицу из файла `<fname>` в регистр `<reg>`. |
| `print <reg>` | Печать матрицы на экран. |
| `add <reg1> <reg2>` | Сложение матриц. |
| `mul <reg1> <reg2>` | Умножение матриц. |
| `elem <reg> <row> <col>` | Печать элемента на экран. |
| `exit` | Завершение работы программы. |

Для обработки ошибок должен использоваться механизм исключений.

## Требования к корректности решения
### Стандартные требования
Смотри стандартные требования из предыдущих заданий (они теперь доступны [в общей папке](../tasks-common)), название папки и файла — `lab_14`.

Новое требование: у всех методов и функций должна быть выполнена базовая гарантия исключений.

### Детали реализации
* Вся работа с матрицами вынесена в отдельный RAII-класс `Matrix` с value-семантикой (как обычно в C++).
  Интерпретатор в `main.cpp` использует этот класс.
* Класс `Matrix` хранит элементы в произвольной структуре, его интерфейс
  требуется разработать самостоятельно.
* Необходимо реализовать отдельный тип `MatrixException`, который хранит информацию о причине сбоя.
* Проверка команд на валидность должна происходить в методах класса `Matrix`.
  Если операция не может быть выполнена, метод бросает объект типа
  `MatrixException`.
* Валидация параметров методов `Matrix` (например, `operator+`) в коде интерпретатора запрещена.

### Консольное приложение
* При запуске `./lab_14` приложение сразу начинает работу и ждёт команд от пользователя
  на стандартном потоке ввода.
* Какие-либо подсказки или приглашения для пользователя отсутствуют.
* Результаты выполнения команд выводятся в стандартный поток вывода.
* Если стандартный ввод заканчивается, программа корректно завершает работу.
* Гарантируется, что формат всех вводимых пользователем команд всегда корректен:
  * Каждая команда занимает ровно одну строчку.
  * Имя регистра состоит из `$` и числа сразу за ним, без пробела: `$0`, `$1`, ..., `$9`
* Если при выполнении команды возникла ошибка, описанная в задании, требуется:
  * Вывести в стандартный поток вывода (не ошибок) соответствующее сообщение.
  * Оставить значения регистров такими же, как и до начала выполнения команды.
    Как будто строгая гарантия исключений с точки зрения пользователя приложения.
  * Ожидать следующую команду.
* Поведение программы при остальных ошибках не определено.
  В частности, если ошибка произошла при выводе сообщения на экран, при считывании команды, или если пользователь ввёл некорректную команду.
* При нехватке памяти при выполнении команды над матрицей (возникшее исключение `std::bad_alloc`)
  на экран выводится сообщение: `Unable to allocate memory.`.
  Если памяти всё ещё не хватает для нормального продолжения работы программы, поведение не определено.

### Команда `load`
Команда `load <reg> <fname>` загружает матрицу из файла с именем `<fname>` в регистр `<reg>`.
Гарантируется, что `<fname>` не содержит пробельных символов.

Формат хранения матрицы в файле:
```
<#rows, строго положительное целое> <#cols, строго положительное целое>
<element 0-0> ... <element 0-#cols>
...
<element #rows-0> ... <element #rows-#cols>
```
Элементы матрицы — целые числа, помещаются в `int` размером 4 байта, записаны в десятичной системе.

Если файл не удалось открыть для чтения, требуется вывести сообщение: `LOAD: unable to open file.`.

Гарантируется, что если файл существует, то либо формат файла полностью корректен, либо
в конце файла не хватает каких-либо чисел.
В этом случае на экран выводится сообщение: `LOAD: invalid file format.`.
В частности, файл может быть пуст или содержать ровно одно число, но не может содержать
символы, кроме пробельных, минуса, плюса и цифр.

#### Пример работы
```
$ cat matrix.txt
2 3
1 2 3
4 5 6
$ cat matrix-bad.txt
2 3
11 12 13
14 15
$ ./lab_14
load $0 matrix.txt
load $0 does-not-exist.txt
LOAD: unable to open file.
load $0 matrix-bad.txt
LOAD: invalid file format.
print $0
1 2 3
4 5 6
exit
$
```

### Команда `print`
Команда `print <reg>` построчно печатает элементы матрицы, хранящейся в `<reg>`.

#### Пример работы
```
$ cat matrix.txt
2 1
1
-1
$ ./lab_14
load $1 matrix.txt
print $1
1
-1
exit
$
```

### Команда `add`
Команда `add <reg1> <rеg2>` поэлементно складывает матрицу из `<reg1>` с матрицей из `<reg2>`.
Результат записывается в `<reg1>`.
Если размеры матриц не совпадают,
на экран выводится сообщение: `ADD: dimensions do not match.`.

#### Пример работы
```
$ cat matrix1.txt
2 2
1 2
3 4
$ cat matrix2.txt
2 2
-1 2
3 -4
$ ./lab_14
load $1 matrix1.txt
load $2 matrix2.txt
add $2 $1
print $2
0 4
6 0
print $1
1 2
3 4
add $1 $0
ADD: dimensions do not match.
exit
$
```

### Команда `mul`
Команда `mul <reg1> <reg2>` умножает матрицу из `<reg1>` на матрицу из `<reg2>`.
Результат записывается в `<reg1>`.
Если размеры матриц не позволяют выполнить умножение,
на экран выводится сообщение: `MUL: #arg1.columns != #arg2.rows.`.

#### Пример работы
```
$ cat matrix1.txt
2 2
1 2
3 4
$ cat matrix2.txt
2 2
-1 2
3 -4
$ ./lab_14
load $1 matrix1.txt
load $2 matrix2.txt
mul $2 $1
print $2
5 6
-9 -10
print $1
1 2
3 4
mul $1 $0
MUL: #arg1.columns != #arg2.rows.
exit
$
```

### Команда `elem`
Команда `elem <reg> <row> <col>` печатает на экран элемент матрицы из регистра `<reg>`,
находящийся в строке `<row>` и столбце `<col>` (нумерация с нуля).
Если элемента не существует, на экран выводится сообщение: `ACCESS: bad index.`.

#### Пример работы
```
$ cat matrix.txt
2 2
1 2
3 4
$ ./lab_14
load $1 matrix.txt
elem $1 0 1
2
elem $1 -2 0
ACCESS: bad index.
exit
$
```

### Команда `exit`
Команда завершает работу интерпретатора с кодом возврата `0` (как при наступлении конца стандартного вывода).

#### Пример работы
```
$ echo exit | ./lab_14 && echo $?
0
$
```

### Структура репозитория
```
<корень-личного-репозитория>
|--lab_14
   |--include
   |  |-- matrix.h
   |--src
   |  |-- main.cpp
   |  |-- matrix.cpp
   |--Makefile
```

Папку `obj`, объектные и исполняемые файлы класть в репозиторий не разрешается.

## Сроки сдачи
Задание выдано 13.02.2020 (четверг).
Крайний срок сдачи — **20.02.2020 (четверг) 22:59 по Москве**.

Также на усмотрение преподавателя могут назначаться дополнительные попытки сдачи и дополнительные сроки
проверки.
Например, преподаватель может оперативно проверить решения, отправленные за несколько дней до дедлайна,
и гораздо медленнее — отправленные перед дедлайном.
Уточняйте у своего преподавателя.

В этом задании, если вы до дедлайна сделали посылку, и преподаватель считает, что недостатки в ней не
фатальны, вам может быть дана дополнительная попытка сдачи для исправления.
Она должна быть явно разрешена вашим преподавателем.
Вы можете сделать её в течении 7 суток после проверки последней посылки.

## Система оценки
* Задание оценивается в 10 баллов: 7 за корректность и 3 за стиль.
* Точные критерии оценки каждой из частей остаются на усмотрение преподавателя.
